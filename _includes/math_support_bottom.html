<!-- <script type="text/javascript">
  $("script[type='math/tex']").replaceWith(function () {
    var tex = $(this).text();
    return "<span class=\"inline-equation\">" +
      katex.renderToString(tex) +
      "</span>";
  });

  $("script[type='math/tex; mode=display']").replaceWith(function () {
    var tex = $(this).text();
    return "<div class=\"equation\">" +
      katex.renderToString("\\displaystyle " + tex) +
      "</div>";
  });
</script> -->

<script type="text/javascript">
  $( document ).ready(function() {
    $("script[type='math/tex']").replaceWith(function() {
        var tex = $(this).text();
        return katex.renderToString(tex, {displayMode: false});
    });

    $("script[type='math/tex; mode=display']").replaceWith(function() {
        var tex = $(this).html();
        return katex.renderToString(tex.replace(/^(% <!\[CDATA\[.)(.*)(.%\]\]>)$/g, '$2'), {displayMode: true});
    });
  });
</script>

<!-- <script type="text/javascript">

</script> -->